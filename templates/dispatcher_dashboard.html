{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="anonymous"/>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
{% endblock %}

{% block content %}
<div class="dispatcher-dashboard">
    <div id="sidebar" class="sidebar">
        <button id="toggleSidebarBtn" class="toggle-btn">
            <i class="fas fa-bars"></i>
        </button>
        <nav class="sidebar-nav">
            <button id="add-trip-btn" class="sidebar-btn">
                <i class="fas fa-plus-circle"></i>
                <span class="btn-text">Add Trip</span>
            </button>
            <button id="add-driver-btn" class="sidebar-btn">
                <i class="fas fa-user"></i>
                <span class="btn-text">Add Driver</span>
            </button>
            <button id="add-passenger-btn" class="sidebar-btn">
                <i class="fas fa-users"></i>
                <span class="btn-text">Add Passenger</span>
            </button>
            <a href="{{ url_for('reporting_dashboard') }}" class="sidebar-btn">
                <i class="fas fa-chart-line"></i>
                <span class="btn-text">Dashboard</span>
            </a>
        </nav>
    </div>
    <div class="main-content">
        <header class="dashboard-header">
            <h1>Dispatcher Dashboard</h1>
            <div class="user-info">
                <span>Welcome, {{ current_user.username }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </header>

        <div class="dashboard-grid">
            <div class="grid-item map-hub">
                <h2>Live Map Hub</h2>
                <div id="map" class="map-container" style="height: 400px;"></div>
            </div>
            <div class="grid-item status-hub">
                <h2>Status Overview</h2>
                <!-- Add your content for the second grid area here -->
            </div>
        </div>

        <div class="filter-bar">
            <div class="filter-group">
                <select id="status-filter" class="filter-select">
                    <option value="all">Status</option>
                    <option value="Pending">Pending</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                </select>
            </div>
            <div class="filter-group">
                <select id="date-range-filter" class="filter-select">
                    <option value="all">Date Range</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="custom">Custom</option>
                </select>
            </div>
            <div class="filter-group">
                <select id="driver-filter" class="filter-select">
                    <option value="all">Driver</option>
                </select>
            </div>
            <div class="filter-group">
                <select id="passenger-filter" class="filter-select">
                    <option value="all">Passenger</option>
                </select>
            </div>
            <button id="apply-filters" class="filter-btn">
                <i class="fas fa-check"></i>
            </button>
            <button id="reset-filters" class="filter-btn">
                <i class="fas fa-redo"></i>
            </button>
        </div>

        <div class="grid-item all-trips">
            <h2>All Trips</h2>
            <div class="table-responsive">
                <table class="trips-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Patient Name</th>
                            <th>Pickup Location</th>
                            <th>Dropoff Location</th>
                            <th>Status</th>
                            <th>Driver</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trip-list">
                        {% for trip in trips %}
                        <tr>
                            <td>{{ trip.id }}</td>
                            <td>{{ trip.patient_name }}</td>
                            <td>{{ trip.pickup_location }}</td>
                            <td>{{ trip.dropoff_location }}</td>
                            <td>{{ trip.status }}</td>
                            <td>{{ trip.driver.username if trip.driver else 'Unassigned' }}</td>
                            <td>
                                <button class="edit-trip-btn" data-trip-id="{{ trip.id }}">Edit</button>
                                <button class="delete-trip-btn" data-trip-id="{{ trip.id }}">Delete</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% include "popup_forms.html" %}
{% endblock %}

{% block scripts %}
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin="anonymous"></script>

    <!-- Socket.io -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/dispatcher.js') }}"></script>
{% endblock %}
