{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
{% endblock %}

{% block content %}
<div class="dispatcher-dashboard">
    <div id="sidebar" class="sidebar">
        <button id="toggleBtn" class="toggle-btn">&lt;&gt;</button>
        <h2 class="sidebar-title">MedQuarters</h2>
        <nav class="sidebar-nav">
            <button id="add-trip-btn" class="sidebar-btn">Add Trip</button>
            <button id="add-driver-btn" class="sidebar-btn">Add Driver</button>
            <button id="add-passenger-btn" class="sidebar-btn">Add Passenger</button>
            <a href="{{ url_for('reporting_dashboard') }}" class="sidebar-btn">Reporting Dashboard</a>
        </nav>
    </div>
    <div class="main-content">
        <header class="dashboard-header">
            <h1>Dispatcher Dashboard</h1>
            <div class="user-info">
                <span>Welcome, {{ current_user.username }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </header>
        
        <div class="dashboard-grid">
            <div class="grid-item map-hub">
                <h2>Live Map Hub</h2>
                <div id="map" class="map-container" style="height: 400px; width: 100%;"></div>
            </div>
            <div class="grid-item trip-summary">
                <h2>Trip Summary</h2>
                <div id="filtered-trips-list" class="filtered-trips-list"></div>
            </div>
        </div>

        <div class="filter-bar">
            <div class="filter-group">
                <label for="status-filter">Status:</label>
                <select id="status-filter" class="filter-select">
                    <option value="All">All Statuses</option>
                    {% for status in statuses %}
                        {% if status != 'All' %}
                            <option value="{{ status }}">{{ status }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <label for="date-range-filter">Date Range:</label>
                <select id="date-range-filter" class="filter-select">
                    <option value="all">All Dates</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="driver-filter">Driver:</label>
                <select id="driver-filter" class="filter-select">
                    <option value="all">All Drivers</option>
                </select>
            </div>
            <button id="apply-filters" class="filter-btn">Apply Filters</button>
        </div>

        <div class="grid-item all-trips">
            <h2>All Trips</h2>
            <div class="table-responsive">
                <table class="trips-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Patient Name</th>
                            <th>Pickup Location</th>
                            <th>Dropoff Location</th>
                            <th>Status</th>
                            <th>Driver</th>
                        </tr>
                    </thead>
                    <tbody id="trip-list">
                        {% for trip in trips %}
                        <tr>
                            <td>{{ trip.id }}</td>
                            <td>{{ trip.patient_name }}</td>
                            <td>{{ trip.pickup_location }}</td>
                            <td>{{ trip.dropoff_location }}</td>
                            <td>{{ trip.status }}</td>
                            <td>{{ trip.driver.username if trip.driver else 'Unassigned' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% include "popup_forms.html" %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dispatcher.js') }}"></script>
{% endblock %}
